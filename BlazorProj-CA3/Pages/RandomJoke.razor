@using BlazorProj_CA3.Services
@page "/random"
@inject IJokeService JokeService

<h3>Random Dad Joke</h3>

<div class="card p-3 mb-3">
    <div class="d-flex justify-content-between align-items-start">
        <div>
            @if (IsLoading)
            {
                <div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>
            }
            else if (!string.IsNullOrEmpty(Error))
            {
                <div class="alert alert-danger">@Error</div>
            }
            else
            {
                <p data-testid="random-joke-text" class="lead">@CurrentJoke</p>
            }
        </div>
        <div>
            <button data-testid="fetch-random-btn" class="btn btn-primary" @onclick="LoadJoke" disabled="@IsLoading">New joke</button>
        </div>
    </div>
</div>

@code {
    string CurrentJoke = "";
    bool IsLoading;
    string? Error;

    protected override async Task OnInitializedAsync()
    {
        await LoadJoke();
    }

    private async Task LoadJoke()
    {
        IsLoading = true;
        Error = null;
        try
        {
            CurrentJoke = await JokeService.GetRandomJokeAsync();
        }
        catch (Exception ex)
        {
            Error = "Could not load a joke. " + ex.Message;
        }
        finally
        {
            IsLoading = false;
            StateHasChanged();
        }
    }
}
